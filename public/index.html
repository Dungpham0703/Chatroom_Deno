<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple Chat Â· Tailwind + TSâ€‘flavored</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                50: '#fff7ed',
                100: '#ffedd5',
                200: '#fed7aa',
                300: '#fdba74',
                400: '#fb923c',
                500: '#f97316',
                600: '#ea580c',
                700: '#c2410c',
                800: '#9a3412',
                900: '#7c2d12',
              },
            },
          },
        },
      };
    </script>
    <style>
      #log i { color: #4b5563; }
      #log b { color: #111827; }
    </style>
  </head>
  <body class="bg-gradient-to-b from-white to-orange-50 min-h-screen text-zinc-900 antialiased">
    <main class="mx-auto max-w-xl px-4 py-8">
      <h2 class="text-2xl font-bold tracking-tight flex items-center gap-2">
        <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-brand-500 text-white">ðŸ’¬</span>
        Chatroom
      </h2>

      <section class="mt-4 rounded-2xl border border-orange-100 bg-white p-4 shadow-[0_10px_30px_rgba(249,115,22,0.08)]">
        <div class="grid grid-cols-1 sm:grid-cols-[1fr_10rem_auto] gap-2">
          <input id="name" placeholder="Your name" class="h-10 rounded-xl border border-zinc-200 bg-zinc-50 px-3 text-sm outline-none focus:border-brand-400 focus:ring-2 focus:ring-brand-200" />
          <input id="room" placeholder="Room number" value="1" class="h-10 rounded-xl border border-zinc-200 bg-zinc-50 px-3 text-sm outline-none focus:border-brand-400 focus:ring-2 focus:ring-brand-200" />
          <button id="join" class="h-10 rounded-xl bg-brand-600 px-4 text-sm font-semibold text-white shadow hover:bg-brand-700 active:scale-[0.99]">Join</button>
        </div>
      </section>

      <section class="mt-4">
        <div id="log" class="h-[320px] overflow-y-auto rounded-2xl border border-orange-100 bg-white/70 p-3 shadow-inner"></div>
      </section>

      <section class="mt-3 rounded-2xl border border-orange-100 bg-white p-3">
        <div class="grid grid-cols-[1fr_auto] gap-2">
          <input id="text" placeholder="Messageâ€¦" class="h-11 rounded-xl border border-zinc-200 bg-zinc-50 px-3 text-sm outline-none focus:border-brand-400 focus:ring-2 focus:ring-brand-200" />
          <button id="send" class="h-11 rounded-xl bg-zinc-900 px-5 text-sm font-semibold text-white shadow hover:bg-zinc-800 active:scale-[0.99]">Send</button>
        </div>
      </section>
    </main>

    <script type="module">

      const logEl = /**@type {HTMLDivElement} */ (document.getElementById('log'));
      const nameEl = /** @type {HTMLInputElement} */ (document.getElementById('name'));
      const roomEl = /** @type {HTMLInputElement} */ (document.getElementById('room'));
      const joinBtn = /** @type {HTMLButtonElement} */ (document.getElementById('join'));
      const textEl = /** @type {HTMLInputElement} */ (document.getElementById('text'));
      const sendBtn = /** @type {HTMLButtonElement} */ (document.getElementById('send'));

      let ws;
      let joined = false;

      function log(html) {
        const div = document.createElement('div');
        div.className = 'my-1';
        div.innerHTML = html;
        logEl.appendChild(div);
        logEl.scrollTop = logEl.scrollHeight;
      }

      joinBtn.onclick = () => {
        ws = new WebSocket(`ws://${location.host}/ws`);
        ws.onopen = () => {
          const name = nameEl.value || 'anon';
          const room = roomEl.value || '1';
          ws?.send(JSON.stringify({ type: 'join', name, room }));
          joined = true;
          log(`<i>Joined room ${room} as ${name}</i>`);
          joinBtn.disabled = true;
          joinBtn.classList.add('opacity-60', 'cursor-not-allowed');
        };
        ws.onmessage = (e) => {
          /** @type {SystemMsg | ChatMsg} */
          const msg = JSON.parse(e.data);
          if (msg.type === 'system') log(`<i>${msg.text}</i>`);
          if (msg.type === 'chat')
            log(`<div class='flex items-start gap-2'>
                  <span class='inline-block rounded-lg bg-orange-100 px-2 py-0.5 text-[13px] font-semibold text-brand-700'>${escapeHtml(msg.name)}</span>
                  <span class='text-[15px]'>${escapeHtml(msg.text)}</span>
                </div>`);
        };
        ws.onclose = () => {
          joined = false;
          joinBtn.disabled = false;
          joinBtn.classList.remove('opacity-60', 'cursor-not-allowed');
          log(`<i>Disconnected.</i>`);
        };
        ws.onerror = () => log(`<i>Connection error.</i>`);
      };

      sendBtn.onclick = () => {
        if (!joined) return alert('Join first!');
        const text = textEl.value.trim();
        if (!text) return;
        ws?.send(JSON.stringify({ type: 'chat', text }));
        textEl.value = '';
        textEl.focus();
      };

      textEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendBtn.click();
        }
      });

      function escapeHtml(str) {
        return str
          .replaceAll('&', '&amp;')
          .replaceAll('<', '&lt;')
          .replaceAll('>', '&gt;')
          .replaceAll('"', '&quot;')
          .replaceAll("'", '&#39;');
      }
    </script>
  </body>
</html>
