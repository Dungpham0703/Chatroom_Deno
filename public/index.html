<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      #log i { color: #4b5563; }
      #log b { color: #111827; }
    </style>
  </head>
  <body class="bg-gradient-to-b from-white to-orange-50 min-h-screen text-zinc-900 antialiased">
    <main class="mx-auto max-w-xl px-4 py-8">
      <h2 class="text-2xl font-bold tracking-tight flex items-center gap-2">
        <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-orange-500 text-white">ðŸ’¬</span>
        Chatroom
      </h2>

      <section class="mt-4 rounded-2xl border border-orange-100 bg-white p-4 shadow">
        <div class="grid grid-cols-1 sm:grid-cols-[1fr_10rem_auto] gap-2">
          <input id="name" placeholder="Your name"
                 class="h-10 rounded-xl border border-zinc-200 bg-zinc-50 px-3 text-sm" />
          <input id="room" placeholder="Room number" value="1"
                 class="h-10 rounded-xl border border-zinc-200 bg-zinc-50 px-3 text-sm" />
          <button id="join"
                  class="h-10 rounded-xl bg-orange-600 px-4 text-sm font-semibold text-white">Join</button>
        </div>
      </section>

      <section class="mt-4">
        <div id="log" class="h-[320px] overflow-y-auto rounded-2xl border border-orange-100 bg-white/70 p-3 shadow-inner"></div>
      </section>

      <section class="mt-3 rounded-2xl border border-orange-100 bg-white p-3">
        <div class="grid grid-cols-[1fr_auto] gap-2">
          <input id="text" placeholder="Messageâ€¦"
                 class="h-11 rounded-xl border border-zinc-200 bg-zinc-50 px-3 text-sm" />
          <button id="send"
                  class="h-11 rounded-xl bg-zinc-900 px-5 text-sm font-semibold text-white">Send</button>
        </div>
      </section>
    </main>

    <script type="module">
      const logEl   = document.getElementById('log');
      const nameEl  = document.getElementById('name');
      const roomEl  = document.getElementById('room');
      const joinBtn = document.getElementById('join');
      const textEl  = document.getElementById('text');
      const sendBtn = document.getElementById('send');

      let ws;
      let joined = false;

      function log(html) {
        const div = document.createElement('div');
        div.className = 'my-1';
        div.innerHTML = html;
        logEl.appendChild(div);
        logEl.scrollTop = logEl.scrollHeight;
      }

      joinBtn.onclick = () => {
        ws = new WebSocket(`ws://${location.host}/ws`);
        ws.onopen = () => {
          const name = nameEl.value || 'anon';
          const room = roomEl.value || '1';
          ws.send(JSON.stringify({ type: 'join', name, room }));
          joined = true;
          log(`<i>Joined room ${room} as ${name}</i>`);
          joinBtn.disabled = true;
        };
        ws.onmessage = (e) => {
          const msg = JSON.parse(e.data);
          if (msg.type === 'system') log(`<i>${msg.text}</i>`);
          if (msg.type === 'chat') log(`<b>${msg.name}:</b> ${msg.text}`);
        };
        ws.onclose = () => {
          joined = false;
          joinBtn.disabled = false;
          log(`<i>Disconnected.</i>`);
        };
        ws.onerror = () => log(`<i>Connection error.</i>`);
      };

      sendBtn.onclick = () => {
        if (!joined) return alert('Join first!');
        const text = textEl.value.trim();
        if (!text) return;
        ws.send(JSON.stringify({ type: 'chat', text }));
        textEl.value = '';
        textEl.focus();
      };

      textEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendBtn.click();
        }
      });
    </script>
  </body>
</html>
